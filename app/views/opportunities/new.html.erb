<%# app/views/opportunities/new.html.erb ‚Äî Formulaire simple + upload photos %>

<div class="bg-gray-50 min-h-screen">
  <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <!-- En-t√™te de page -->
    <div class="mb-8 flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3">
      <div class="min-w-0">
        <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight text-gray-900">
          Proposer une opportunit√©
        </h1>
        <p class="mt-2 text-gray-600">
          Vous connaissez une mission, formation, rencontre ou projet √† valoriser&nbsp;? Partagez-la ici.
          Chaque proposition est v√©rifi√©e par notre √©quipe avant publication.
        </p>
      </div>
      <div class="shrink-0">
        <%= link_to "Retour aux opportunit√©s", opportunities_path,
              class: "inline-flex items-center gap-2 rounded-lg border border-gray-200 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50" %>
      </div>
    </div>

    <!-- Errors -->
<% if @opportunity.errors[:category].any? %>
  <div class="rounded-xl border border-rose-200 bg-rose-50 px-6 py-4 mb-6 text-sm text-rose-800">
    <div class="font-semibold">
      ‚ö†Ô∏è La s√©lection d'une cat√©gorie est n√©cessaire, voir ci-dessous, merci !
    </div>
  </div>
<% end %>


    <div class="grid grid-cols-1 lg:grid-cols-[minmax(0,1.4fr)_minmax(0,1fr)] gap-8">
      <!-- FORMULAIRE -->
      <section class="min-w-0">
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
          <%= form_with model: @opportunity, local: true, html: { multipart: true } do |f| %>

            <!-- Titre -->
            <div class="mb-6">
              <%= f.label :title, "Titre", class: "block text-sm font-medium text-gray-900" %>
              <%= f.text_field :title, required: true,
                    placeholder: "Un titre clair et concis ‚Äî ex. ‚ÄúDistribution de repas (Paris 12e)‚Äù",
                    class: "mt-2 w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500" %>
            </div>

            <!-- Description -->
            <div class="mb-6">
              <%= f.label :description, "Description", class: "block text-sm font-medium text-gray-900" %>
              <%= f.text_area :description, rows: 6, required: true,
                    placeholder: "D√©crivez l‚Äôopportunit√©, les missions, le public vis√©, les pr√©requis, le lieu‚Ä¶",
                    class: "mt-2 w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500" %>
              <p class="mt-2 text-xs text-gray-500">
                Astuce : pr√©cisez les modalit√©s (jours/horaires) et l‚Äôimpact attendu.
              </p>
            </div>

            <!-- Photos (d√©plac√© sous la description) -->
            <div class="mb-8">
              <%= f.label :photos, "Photos (facultatif)", class: "block text-sm font-medium text-gray-900" %>
              <%= f.file_field :photos,
                    multiple: true,
                    accept: "image/*",
                    class: "mt-2 block w-full text-sm text-gray-700
                            file:mr-4 file:py-2 file:px-3
                            file:rounded-md file:border-0
                            file:text-sm file:font-semibold
                            file:bg-indigo-50 file:text-indigo-700
                            hover:file:bg-indigo-100" %>
              <p class="mt-2 text-xs text-gray-500">
                Vous pouvez ajouter une ou plusieurs photos (JPG ou PNG, taille raisonnable).
              </p>
            </div>

<% category_has_error = @opportunity.errors[:category].present? %>

<!-- Cat√©gorie (segmented buttons) -->
<div class="mb-8">
  <span class="block text-sm font-medium <%= category_has_error ? 'text-rose-700' : 'text-gray-900' %> mb-2">
    Cat√©gorie
  </span>

  <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
    <% [
      ["benevolat",    "‚ù§Ô∏è", "B√©n√©volat",    "bg-rose-50",    "text-rose-700",    "ring-rose-300"],
      ["formation",    "üìò", "Formation",    "bg-blue-50",    "text-blue-700",    "ring-blue-300"],
      ["rencontres",   "üë•", "Rencontres",   "bg-emerald-50", "text-emerald-700", "ring-emerald-300"],
      ["entreprendre", "üíº", "Entreprendre", "bg-orange-50",  "text-orange-700",  "ring-orange-300"]
    ].each do |val, emoji, label, bg, fg, ring| %>
      <div>
        <%= f.radio_button :category, val, id: "cat_#{val}", class: "peer sr-only" %>
        <label for="cat_<%= val %>"
               class="flex items-center justify-center gap-2 rounded-lg border px-3 py-2 text-sm font-medium cursor-pointer
                      border-gray-200 hover:bg-gray-50
                      peer-checked:<%= bg %> peer-checked:<%= fg %>
                      peer-checked:border-transparent peer-checked:ring-2 peer-checked:<%= ring %>
                      <%= 'border-rose-300 ring-1 ring-rose-300/70' if category_has_error && @opportunity.category.blank? %>">
          <span><%= emoji %></span>
          <span><%= label %></span>
        </label>
      </div>
    <% end %>
  </div>

  <p class="mt-2 text-xs <%= category_has_error ? 'text-rose-700 font-semibold' : 'text-gray-500' %>">
    <% if category_has_error %>
      Veuillez s√©lectionner une cat√©gorie pour continuer.
    <% else %>
      Choisissez la cat√©gorie la plus pertinente (b√©n√©volat, formation, rencontres, entreprendre‚Ä¶).
    <% end %>
  </p>
</div>


            <!-- Organisation + site -->
            <div class="grid sm:grid-cols-2 gap-6 mb-6">
              <div>
                <%= f.label :organization, "Organisation porteuse", class: "block text-sm font-medium text-gray-900" %>
                <%= f.text_field :organization, placeholder: "Nom de l‚Äôassociation, de l‚Äô√©cole, du collectif‚Ä¶",
                      class: "mt-2 w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500" %>
              </div>
              <div>
                <%= f.label :website, "Site web (facultatif)", class: "block text-sm font-medium text-gray-900" %>
                <%= f.url_field :website, placeholder: "https://‚Ä¶",
                      class: "mt-2 w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500" %>
              </div>
            </div>

            <!-- Adresse -->
            <div class="grid sm:grid-cols-3 gap-6 mb-6">
              <div class="sm:col-span-2">
                <%= f.label :address, "Adresse", class: "block text-sm font-medium text-gray-900" %>
                <%= f.text_field :address, placeholder: "12 rue de l‚ÄôExemple",
                      class: "mt-2 w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500" %>
              </div>
              <div>
                <%= f.label :postcode, "Code postal", class: "block text-sm font-medium text-gray-900" %>
                <%= f.text_field :postcode, placeholder: "75012",
                      class: "mt-2 w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500" %>
              </div>
            </div>

            <div class="grid sm:grid-cols-3 gap-6 mb-6">
              <div>
                <%= f.label :city, "Ville", class: "block text-sm font-medium text-gray-900" %>
                <%= f.text_field :city, placeholder: "Paris",
                      class: "mt-2 w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500" %>
              </div>
              <div>
                <%= f.label :time_commitment, "Temps √† pr√©voir", class: "block text-sm font-medium text-gray-900" %>
                <%= f.text_field :time_commitment, placeholder: "ex. 3h/semaine",
                      class: "mt-2 w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500" %>
              </div>
              <div>
                <%= f.label :effort_level, "Niveau d‚Äôengagement", class: "block text-sm font-medium text-gray-900" %>
                <%= f.select :effort_level,
                      [["L√©ger", "leger"], ["Mod√©r√©", "modere"], ["Intensif", "intensif"]],
                      { include_blank: "‚Äî Choisir ‚Äî" },
                      class: "mt-2 w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500" %>
              </div>
            </div>

            <!-- Contacts -->
            <div class="grid sm:grid-cols-3 gap-6 mb-6">
              <div>
                <%= f.label :contact_email, "Email de contact", class: "block text-sm font-medium text-gray-900" %>
                <%= f.email_field :contact_email, placeholder: "prenom@organisation.org",
                      class: "mt-2 w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500" %>
              </div>
              <div>
                <%= f.label :contact_phone, "T√©l√©phone", class: "block text-sm font-medium text-gray-900" %>
                <%= f.telephone_field :contact_phone, placeholder: "ex. 01 23 45 67 89",
                      class: "mt-2 w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500" %>
              </div>
              <div>
                <%= f.label :tags, "Tags (s√©par√©s par des virgules)", class: "block text-sm font-medium text-gray-900" %>
                <%= f.text_field :tags, placeholder: "solidarit√©, jeunesse, num√©rique‚Ä¶",
                      class: "mt-2 w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500" %>
              </div>
            </div>

            <!-- CTA final : un seul bouton de validation -->
            <div class="mt-8 flex flex-col sm:flex-row gap-3 sm:items-center">
              <%= f.submit "Valider et envoyer √† D√©clic",
                    class: "inline-flex items-center justify-center px-5 py-3 rounded-lg bg-indigo-600 text-white font-semibold hover:bg-indigo-700",
                    data: { disable_with: "Envoi en cours‚Ä¶" } %>

              <p class="text-xs text-gray-500 sm:ml-2">
                En envoyant, vous acceptez que votre proposition soit mod√©r√©e avant publication.
              </p>
            </div>

          <% end %> <!-- fin du form_with -->
        </div>
      </section>

      <!-- Colonne aide -->
      <aside class="lg:sticky lg:top-6 space-y-6">
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
          <h2 class="font-semibold text-gray-900">Conseils pour une fiche efficace</h2>
          <ul class="mt-3 text-sm text-gray-700 space-y-2">
            <li>‚Ä¢ Soyez pr√©cis sur le lieu, les horaires et les pr√©requis.</li>
            <li>‚Ä¢ Ajoutez un site ou un moyen de contact fiable.</li>
            <li>‚Ä¢ Choisissez la cat√©gorie la plus pertinente (b√©n√©volat, formation‚Ä¶)</li>
            <li>‚Ä¢ Utilisez des <em>tags</em> pour faciliter la recherche.</li>
          </ul>
        </div>

        <div class="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-2xl border border-indigo-100 p-6">
          <h3 class="font-semibold text-gray-900">Mod√©ration</h3>
          <p class="mt-2 text-sm text-gray-700">
            Les contenus √† caract√®re politique, commercial non li√© √† l‚Äôint√©r√™t g√©n√©ral, ou contraires √† la loi ne
            seront pas publi√©s. Nous pouvons adapter l√©g√®rement les textes pour coh√©rence √©ditoriale.
          </p>
        </div>
      </aside>
    </div>
  </main>
</div>
