<%= form_with model: [:admin, @opportunity],
              local: true,
              html: { multipart: true } do |f| %>

  <% if @opportunity.errors.any? %>
    <div class="form-errors">
      <h2><%= pluralize(@opportunity.errors.count, "erreur") %> :</h2>
      <ul>
        <% @opportunity.errors.full_messages.each do |m| %>
          <li><%= m %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-sections">
    <%# ========== SECTION 1 : INFORMATIONS DE BASE ========== %>
    <div class="form-section">
      <h3 class="section-title">üìã Informations de base</h3>
      <div class="form-grid">
        <div class="field">
          <%= f.label :title, "Titre" %>
          <%= f.text_field :title %>
        </div>

        <div class="field">
          <%= f.label :category, "Cat√©gorie" %>
          <%= f.select :category,
                [
                  ["B√©n√©volat", "benevolat"],
                  ["Formation", "formation"],
                  ["Rencontres", "rencontres"],
                  ["Entreprendre", "entreprendre"],
                  ["√âcologiser", "ecologiser"]
                ],
                { include_blank: "(choisir)" } %>
        </div>

        <div class="field">
          <%= f.label :is_active, "Active ?" %>
          <div class="checkbox-inline">
            <%= f.check_box :is_active %>
            <span>Visible sur le site</span>
          </div>
        </div>

        <div class="field">
          <%= f.label :organization, "Organisation" %>
          <%= f.text_field :organization %>
        </div>

        <div class="field full">
          <%= f.label :description, "Description (utilisez **texte** pour grasser)" %>
          <%= f.text_area :description, rows: 8 %>
          <small class="field-hint">Utilisez **mot** pour mettre en gras. Le texte sera affich√© avec une police plus grande sur la page.</small>
        </div>
      </div>
    </div>

    <%# ========== SECTION 2 : CITATION & T√âMOIGNAGE ========== %>
    <div class="form-section">
      <h3 class="section-title">üí¨ Citation / T√©moignage</h3>
      <div class="form-grid">
        <div class="field full">
          <%= f.label :quote, "Citation inspirante" %>
          <%= f.text_area :quote, rows: 3, placeholder: "¬´ En 48h, j'avais 15 messages de personnes pr√™tes √† aider... ¬ª" %>
          <small class="field-hint">Une citation marquante d'un participant ou fondateur. Sera affich√©e apr√®s la description.</small>
        </div>

        <div class="field">
          <%= f.label :quote_author, "Auteur de la citation" %>
          <%= f.text_field :quote_author, placeholder: "Marie, fondatrice du Repair Caf√©" %>
        </div>
      </div>
    </div>

    <%# ========== SECTION 3 : STATISTIQUES D'IMPACT ========== %>
    <div class="form-section">
      <h3 class="section-title">üìä Statistiques d'impact</h3>
      <p class="section-desc">4 statistiques cl√©s affich√©es en chiffres color√©s sous la description</p>
      <div class="form-grid stats-grid">
        <div class="stat-pair">
          <div class="field">
            <%= f.label :stat_1_number, "Stat 1 - Nombre" %>
            <%= f.text_field :stat_1_number, placeholder: "200+" %>
          </div>
          <div class="field">
            <%= f.label :stat_1_label, "Stat 1 - Label" %>
            <%= f.text_field :stat_1_label, placeholder: "objets r√©par√©s" %>
          </div>
        </div>

        <div class="stat-pair">
          <div class="field">
            <%= f.label :stat_2_number, "Stat 2 - Nombre" %>
            <%= f.text_field :stat_2_number, placeholder: "45" %>
          </div>
          <div class="field">
            <%= f.label :stat_2_label, "Stat 2 - Label" %>
            <%= f.text_field :stat_2_label, placeholder: "participants r√©guliers" %>
          </div>
        </div>

        <div class="stat-pair">
          <div class="field">
            <%= f.label :stat_3_number, "Stat 3 - Nombre" %>
            <%= f.text_field :stat_3_number, placeholder: "3 ans" %>
          </div>
          <div class="field">
            <%= f.label :stat_3_label, "Stat 3 - Label" %>
            <%= f.text_field :stat_3_label, placeholder: "d'existence" %>
          </div>
        </div>

        <div class="stat-pair">
          <div class="field">
            <%= f.label :stat_4_number, "Stat 4 - Nombre" %>
            <%= f.text_field :stat_4_number, placeholder: "2x" %>
          </div>
          <div class="field">
            <%= f.label :stat_4_label, "Stat 4 - Label" %>
            <%= f.text_field :stat_4_label, placeholder: "par mois" %>
          </div>
        </div>
      </div>
    </div>

    <%# ========== SECTION 4 : D√âFIS SURMONT√âS ========== %>
    <div class="form-section">
      <h3 class="section-title">üí™ D√©fis surmont√©s</h3>
      <div class="form-grid">
        <div class="field full">
          <%= f.label :challenges, "D√©fis et solutions (un par ligne)" %>
          <%= f.text_area :challenges, rows: 6, placeholder: "**Trouver un lieu :** N√©gociation avec la mairie pendant 2 mois, puis accord pour une salle municipale gratuite\n**Assurance :** Souscription d'une assurance responsabilit√© civile via l'association de quartier (120‚Ç¨/an)\n**Mat√©riel :** Appel aux dons qui a permis de collecter outils, fer √† souder et machines √† coudre d'occasion" %>
          <small class="field-hint">Format : **D√©fi :** Solution (un par ligne). Sera affich√© dans un encadr√© rose.</small>
        </div>
      </div>
    </div>

    <%# ========== SECTION 5 : LOCALISATION ========== %>
    <div class="form-section">
      <h3 class="section-title">üìç Localisation</h3>
      <div class="form-grid">
        <div class="field">
          <%= f.label :location, "Adresse / lieu" %>
          <%= f.text_field :location %>
        </div>

        <div class="field">
          <%= f.label :latitude %>
          <%= f.text_field :latitude, placeholder: "48.6936" %>
        </div>

        <div class="field">
          <%= f.label :longitude %>
          <%= f.text_field :longitude, placeholder: "6.1832" %>
        </div>
      </div>
    </div>

    <%# ========== SECTION 6 : IMAGES ========== %>
    <div class="form-section">
      <h3 class="section-title">üñºÔ∏è Images</h3>
      <div class="form-grid">
        <div class="field">
          <%= f.label :image, "Image principale (upload)" %>
          <%= f.file_field :image, direct_upload: true %>
          <% if @opportunity.image.attached? %>
            <p class="preview-label">Image actuelle :</p>
            <%= image_tag @opportunity.image.variant(resize_to_limit: [300, 180]),
                          class: "preview-img" rescue nil %>
          <% end %>
          <small class="field-hint">Ratio recommand√© : 16:9</small>
        </div>

        <div class="field">
          <%= f.label :image_url, "Image principale (URL externe)" %>
          <%= f.text_field :image_url, placeholder: "https://‚Ä¶" %>
          <small class="field-hint">Alternative √† l'upload. URL d'image externe.</small>
        </div>
      </div>
    </div>

    <%# ========== SECTION 7 : DATES & HORAIRES ========== %>
    <div class="form-section">
      <h3 class="section-title">üìÖ Dates & horaires</h3>
      <div class="form-grid">
        <div class="field">
          <%= f.label :time_commitment, "Temps √† pr√©voir" %>
          <%= f.text_field :time_commitment, placeholder: "2h par semaine" %>
        </div>

        <div class="field">
          <%= f.label :starts_at, "D√©but" %>
          <%= f.datetime_select :starts_at, include_blank: true %>
        </div>

        <div class="field">
          <%= f.label :ends_at, "Fin" %>
          <%= f.datetime_select :ends_at, include_blank: true %>
        </div>
      </div>
    </div>

    <%# ========== SECTION 8 : CONTACT & LIENS ========== %>
    <div class="form-section">
      <h3 class="section-title">üìû Contact & liens</h3>
      <div class="form-grid">
        <div class="field">
          <%= f.label :contact_email, "Email contact" %>
          <%= f.email_field :contact_email %>
        </div>

        <div class="field">
          <%= f.label :contact_phone, "T√©l√©phone contact" %>
          <%= f.telephone_field :contact_phone %>
        </div>

        <div class="field">
          <%= f.label :website, "Site web (URL)" %>
          <%= f.text_field :website, placeholder: "https://‚Ä¶" %>
        </div>

        <div class="field">
          <%= f.label :source_url, "Lien source / infos" %>
          <%= f.text_field :source_url, placeholder: "https://‚Ä¶" %>
        </div>
      </div>
    </div>

    <%# ========== SECTION 9 : AUTRES ========== %>
    <div class="form-section">
      <h3 class="section-title">üè∑Ô∏è Autres informations</h3>
      <div class="form-grid">
        <div class="field">
          <%= f.label :tags, "Tags (s√©par√©s par des virgules)" %>
          <%= f.text_field :tags, placeholder: "r√©paration, √©cologie, solidarit√©" %>
        </div>
      </div>
    </div>
  </div>

  <div class="form-actions">
    <%= f.submit class: "btn" %>
    <%= link_to "Annuler", admin_opportunities_path, class: "btn ghost" %>
  </div>
<% end %>

<style>
.form-errors{background:#fef2f2;border:1px solid #fecaca;color:#b91c1c;padding:.75rem 1rem;border-radius:8px;margin-bottom:1rem}
.form-errors h2{margin:0 0 .5rem;font-weight:700;font-size:.95rem}
.form-errors ul{margin:0;padding-left:1.1rem}

.form-sections{display:flex;flex-direction:column;gap:1.5rem}
.form-section{background:#f8fafc;border:1px solid #e2e8f0;border-radius:12px;padding:1.25rem}
.section-title{margin:0 0 .75rem;font-size:1.05rem;font-weight:700;color:#0f172a;display:flex;align-items:center;gap:.5rem}
.section-desc{margin:0 0 1rem;font-size:.875rem;color:#64748b;font-style:italic}

.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem}
.stats-grid{grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}
.stat-pair{display:flex;flex-direction:column;gap:.75rem;padding:.75rem;background:white;border-radius:8px;border:1px solid #e2e8f0}

.field{display:flex;flex-direction:column;gap:.25rem}
.field.full{grid-column:1/-1}
.field label{font-weight:600;font-size:.9rem;color:#334155}
.field input,.field textarea,.field select{border:1px solid #cbd5e1;border-radius:8px;padding:.4rem .55rem;font:inherit}
.field-hint{font-size:.8rem;color:#64748b;margin-top:.25rem;font-style:italic}

.checkbox-inline{display:flex;align-items:center;gap:.4rem;margin-top:.15rem}
.form-actions{margin-top:1.5rem;display:flex;gap:.5rem;position:sticky;bottom:0;background:white;padding:1rem;border-top:2px solid #e2e8f0;z-index:10}
.btn{padding:.625rem 1.25rem;border-radius:8px;font-weight:600;border:none;cursor:pointer;text-decoration:none;display:inline-block}
.btn:not(.ghost){background:#6366f1;color:white}
.btn.ghost{background:transparent;border:1px solid #cbd5e1;color:#334155}

.preview-label{margin-top:.4rem;font-size:.85rem;color:#64748b}
.preview-img{margin-top:.25rem;border-radius:8px;border:1px solid #e5e7eb;max-width:100%;height:auto}
</style>
