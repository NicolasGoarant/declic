<%# app/views/stories/show.html.erb - VERSION FINALE RESPONSIVE + COULEURS STORIES %>

<%
# Configuration th√®me
story_haystack = @story.title.to_s.downcase
is_eco = story_haystack.include?('jardin') || story_haystack.include?('laiterie') || story_haystack.include?('√©cologie')
is_social = story_haystack.include?('rencontr') || story_haystack.include?('caf√©')
is_entreprendre = story_haystack.include?('entreprise') || story_haystack.include?('fromag') || story_haystack.include?('commerce')

theme = if is_eco
  { name: "√âcologiser", color: "emerald", gradient: "from-emerald-500 to-teal-500", bg: "bg-emerald-50", icon: "üå±" }
elsif is_social
  { name: "Rencontres", color: "amber", gradient: "from-amber-500 to-orange-500", bg: "bg-amber-50", icon: "‚òï" }
elsif is_entreprendre
  { name: "Entreprendre", color: "orange", gradient: "from-orange-500 to-red-500", bg: "bg-orange-50", icon: "üöÄ" }
else
  { name: "Belle Histoire", color: "purple", gradient: "from-purple-500 to-pink-500", bg: "bg-purple-50", icon: "‚ú®" }
end

story_emoji = defined?(emoji_for) ? emoji_for(@story.title) : "üëç"

# Format date fran√ßais
date_fr = if @story.happened_on.present?
  day_names = ['dimanche', 'lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi']
  month_names = ['', 'janvier', 'f√©vrier', 'mars', 'avril', 'mai', 'juin',
                 'juillet', 'ao√ªt', 'septembre', 'octobre', 'novembre', 'd√©cembre']
  "#{day_names[@story.happened_on.wday].capitalize} #{@story.happened_on.day.to_s.rjust(2, '0')} #{month_names[@story.happened_on.month]} #{@story.happened_on.year}"
else
  ""
end
%>

<style>
/* Styles inline pour √©viter les conflits */
.story-hero-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}
.story-spacing-1 { height: 40px; }
.story-spacing-2 { height: 30px; }
.story-spacing-3 { height: 25px; }
.story-separator {
  height: 1px;
  background: linear-gradient(90deg, transparent, #cbd5e1, transparent);
  margin: 30px 0;
}

/* RESPONSIVE FIXES */
@media (max-width: 1024px) {
  .story-grid {
    grid-template-columns: 1fr !important;
  }
  .story-sidebar {
    position: static !important;
  }
}

@media (max-width: 640px) {
  .story-hero-title {
    font-size: 28px !important;
  }
  .story-hero-emoji {
    font-size: 36px !important;
  }
  .story-quote-text {
    font-size: 18px !important;
  }
  .story-section-title {
    font-size: 20px !important;
  }
  .story-chiffres {
    grid-template-columns: 1fr !important;
  }
  .story-cta-title {
    font-size: 24px !important;
  }
}
</style>

<div style="background: white; min-height: 100vh;">

  <%# ========== H√âROS AVEC PHOTO ========== %>
  <div style="position: relative; height: 500px; overflow: hidden; background: #1e293b;">

    <%# PHOTO - V√©rifie image_url, puis image, puis photo, puis fallback %>
    <%
    image_src = nil

    if @story.image_url.present? && @story.image_url.start_with?('http')
      image_src = @story.image_url
    elsif @story.respond_to?(:image) && @story.image.attached?
      image_src = url_for(@story.image) rescue nil
    elsif @story.respond_to?(:photo) && @story.photo.attached?
      image_src = url_for(@story.photo) rescue nil
    end
    %>

    <% if image_src.present? %>
      <img src="<%= image_src %>"
           class="story-hero-image"
           alt="<%= @story.title %>"
           loading="eager"
           onerror="this.src='https://images.unsplash.com/photo-1452195100486-9cc805987862?w=1920&q=80'" />
    <% else %>
      <img src="https://images.unsplash.com/photo-1452195100486-9cc805987862?w=1920&q=80"
           class="story-hero-image"
           alt="Fromages artisanaux" />
    <% end %>

    <%# Overlay %>
    <div style="position: absolute; inset: 0; background: linear-gradient(180deg, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.4) 50%, rgba(0,0,0,0.75) 100%);"></div>

    <%# Contenu %>
    <div style="position: absolute; bottom: 0; left: 0; right: 0; padding: 40px 24px;">
      <div style="max-width: 1140px; margin: 0 auto;">

        <%# Badge %>
        <div style="display: inline-flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.3); padding: 8px 16px; border-radius: 999px; margin-bottom: 16px;">
          <span style="font-size: 20px;"><%= theme[:icon] %></span>
          <span style="color: white; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;"><%= theme[:name] %></span>
        </div>

        <%# Titre %>
        <h1 class="story-hero-title" style="color: white; font-size: 42px; font-weight: 800; line-height: 1.2; margin: 0 0 20px 0; max-width: 900px; word-wrap: break-word;">
          <%= @story.title %>
        </h1>

        <%# Date en fran√ßais %>
        <% if date_fr.present? %>
          <div style="display: flex; align-items: center; gap: 10px; color: rgba(255,255,255,0.95); font-size: 15px; margin-bottom: 12px; flex-wrap: wrap;">
            <svg style="width: 18px; height: 18px; flex-shrink: 0;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            <span style="font-weight: 600;"><%= date_fr %></span>
          </div>
        <% end %>

        <%# Source %>
        <% if @story.source_name.present? %>
          <div style="display: flex; align-items: center; gap: 8px; color: rgba(255,255,255,0.85); font-size: 14px; flex-wrap: wrap;">
            <svg style="width: 16px; height: 16px; flex-shrink: 0;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
            </svg>
            <span>Source : <strong><%= @story.source_name %></strong></span>
          </div>
        <% end %>

      </div>
    </div>
  </div>

  <%# ESPACEMENT 1 %>
  <div class="story-spacing-1"></div>

  <%# ========== CITATION - COULEUR STORIES (PURPLE/PINK) ========== %>
  <div style="max-width: 1140px; margin: 0 auto; padding: 0 24px;">
    <div style="max-width: 860px; margin: 0 auto;">
      <div style="padding: 32px; background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%); border-radius: 20px; box-shadow: 0 10px 40px rgba(168,85,247,0.25);">
        <div style="display: flex; align-items: start; gap: 20px;">
          <div style="font-size: 64px; color: rgba(255,255,255,0.3); line-height: 1; user-select: none; flex-shrink: 0;">"</div>
          <p class="story-quote-text" style="color: white; font-size: 22px; font-weight: 500; line-height: 1.6; margin: 0; word-wrap: break-word;">
            Je ne me voyais pas passer ma vie derri√®re un ordinateur. J'avais besoin d'une activit√© tourn√©e vers le partage, qui me ressemble.
          </p>
        </div>
      </div>
    </div>
  </div>

  <%# ESPACEMENT 2 %>
  <div class="story-spacing-2"></div>

  <%# ========== CHAPO ========== %>
  <div style="max-width: 1140px; margin: 0 auto; padding: 0 24px;">
    <div style="max-width: 860px; margin: 0 auto;">
      <%
      chapo_text = if @story.chapo.present?
        @story.chapo
      elsif @story.body.present?
        paragraphs = @story.body.to_s.split("\n\n")
        paragraphs.first(2).join("\n\n").strip
      else
        ""
      end
      %>
      <% if chapo_text.present? %>
        <div style="font-size: 18px; line-height: 1.7; color: #475569; word-wrap: break-word; overflow-wrap: break-word;">
          <%= simple_format(chapo_text) %>
        </div>
      <% end %>
    </div>
  </div>

  <%# S√âPARATEUR %>
  <div style="max-width: 1140px; margin: 40px auto; padding: 0 24px;">
    <div class="story-separator"></div>
  </div>

  <%# ========== CONTENU ========== %>
  <div style="max-width: 1140px; margin: 0 auto; padding: 0 24px 60px;">
    <div class="story-grid" style="display: grid; grid-template-columns: 1fr 320px; gap: 40px;">

      <%# COLONNE PRINCIPALE %>
      <div style="min-width: 0; overflow-wrap: break-word;">

        <%# Titre section %>
        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 2px solid #e2e8f0; flex-wrap: wrap;">
          <div style="font-size: 40px; flex-shrink: 0;"><%= story_emoji %></div>
          <h2 class="story-section-title" style="font-size: 32px; font-weight: 700; color: #0f172a; margin: 0; word-wrap: break-word;">Le r√©cit de l'action</h2>
        </div>

        <%# Section 1 %>
        <div style="margin-bottom: 50px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #a855f7, #ec4899); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(168,85,247,0.3); flex-shrink: 0;">
              <span style="font-size: 24px;">üí≠</span>
            </div>
            <h3 style="font-size: 24px; font-weight: 700; color: #1e293b; margin: 0; word-wrap: break-word;">Le d√©clic</h3>
          </div>
          <div style="background: linear-gradient(135deg, #faf5ff 0%, #fff 100%); padding: 24px; border-radius: 16px; border-left: 4px solid #a855f7; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
            <p style="font-size: 17px; line-height: 1.7; color: #475569; margin: 0; word-wrap: break-word; overflow-wrap: break-word;">
              Apr√®s quatre ann√©es dans la finance parisienne, B√©n√©dicte Begin ressent le besoin d'un changement radical. √Ä 33 ans, elle aspire √† une vie plus concr√®te, plus proche de ses valeurs et de ses racines lorraines.
            </p>
          </div>
        </div>

        <div class="story-separator"></div>

        <%# Section 2 %>
        <div style="margin-bottom: 50px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #a855f7, #ec4899); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(168,85,247,0.3); flex-shrink: 0;">
              <span style="font-size: 24px;">üìö</span>
            </div>
            <h3 style="font-size: 24px; font-weight: 700; color: #1e293b; margin: 0; word-wrap: break-word;">La formation</h3>
          </div>
          <p style="font-size: 17px; line-height: 1.7; color: #475569; margin-bottom: 20px; word-wrap: break-word; overflow-wrap: break-word;">
            La reconversion ne s'improvise pas. B√©n√©dicte suit une formation compl√®te d'un an aupr√®s de fromagers affineurs parisiens. Elle se familiarise avec les produits √† travers des stages pratiques et obtient une attestation de formation en vente de cr√®merie-fromagerie.
          </p>
          <div style="background: #eff6ff; padding: 24px; border-radius: 16px; border-left: 4px solid #3b82f6; box-shadow: 0 4px 12px rgba(59,130,246,0.1);">
            <div style="display: flex; align-items: start; gap: 12px;">
              <span style="font-size: 24px; flex-shrink: 0;">üí°</span>
              <div style="min-width: 0;">
                <p style="font-weight: 600; color: #1e40af; margin: 0 0 8px 0; word-wrap: break-word;">Le conseil de B√©n√©dicte</p>
                <p style="font-style: italic; color: #475569; line-height: 1.7; margin: 0; word-wrap: break-word; overflow-wrap: break-word;">
                  "Pour r√©ussir sa reconversion, il faut se former s√©rieusement et multiplier les stages pratiques. C'est comme √ßa qu'on apprend vraiment le m√©tier."
                </p>
              </div>
            </div>
          </div>
        </div>

        <div class="story-separator"></div>

        <%# Section 3 %>
        <div style="margin-bottom: 50px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #a855f7, #ec4899); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(168,85,247,0.3); flex-shrink: 0;">
              <span style="font-size: 24px;">üè™</span>
            </div>
            <h3 style="font-size: 24px; font-weight: 700; color: #1e293b; margin: 0; word-wrap: break-word;">L'ouverture de Caseus</h3>
          </div>
          <p style="font-size: 17px; line-height: 1.7; color: #475569; margin-bottom: 30px; word-wrap: break-word; overflow-wrap: break-word;">
            B√©n√©dicte trouve son bonheur dans une ancienne librairie de 45 m¬≤ au 21 Grande-Rue, en plein c≈ìur du Vieux-Nancy. Deux mois de travaux sont n√©cessaires pour transformer l'espace en cr√®merie-fromagerie moderne et accueillante.
          </p>

          <%# Chiffres cl√©s %>
          <div class="story-chiffres" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin: 30px 0;">
            <div style="background: #fef3c7; border: 2px solid #fde68a; padding: 24px; border-radius: 16px; text-align: center;">
              <div style="font-size: 40px; margin-bottom: 8px;">üßÄ</div>
              <div style="font-size: 32px; font-weight: 700; color: #92400e; margin-bottom: 4px;">70</div>
              <div style="font-size: 12px; font-weight: 600; color: #b45309; text-transform: uppercase; letter-spacing: 0.5px;">r√©f√©rences</div>
            </div>
            <div style="background: #d1fae5; border: 2px solid #a7f3d0; padding: 24px; border-radius: 16px; text-align: center;">
              <div style="font-size: 40px; margin-bottom: 8px;">üå±</div>
              <div style="font-size: 32px; font-weight: 700; color: #064e3b; margin-bottom: 4px;">3</div>
              <div style="font-size: 12px; font-weight: 600; color: #047857; text-transform: uppercase; letter-spacing: 0.5px;">producteurs</div>
            </div>
            <div style="background: #f3e8ff; border: 2px solid #e9d5ff; padding: 24px; border-radius: 16px; text-align: center;">
              <div style="font-size: 40px; margin-bottom: 8px;">ü•™</div>
              <div style="font-size: 32px; font-weight: 700; color: #581c87; margin-bottom: 4px;">45</div>
              <div style="font-size: 12px; font-weight: 600; color: #7e22ce; text-transform: uppercase; letter-spacing: 0.5px;">m¬≤ boutique</div>
            </div>
          </div>

          <p style="font-size: 17px; line-height: 1.7; color: #475569; word-wrap: break-word; overflow-wrap: break-word;">
            Au menu : des yaourts infus√©s de la laiterie Odla (Manoncourt-en-Vermois), des fromages de l'√âtoile de la Colline (Goviller) et de la Ch√®vrerie du Haut de la Vigne (Mign√©ville). B√©n√©dicte apporte aussi sa touche personnelle avec des cr√©ations originales : brie au pesto, coulommiers fa√ßon nougat avec abricots, pistaches, noisettes et amandes.
          </p>
        </div>

        <div class="story-separator"></div>

        <%# Section 4 %>
        <% if @story.respond_to?(:highlights_title) && @story.highlights_title.present? %>
        <div style="margin-bottom: 50px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #a855f7, #ec4899); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(168,85,247,0.3); flex-shrink: 0;">
              <span style="font-size: 24px;">üéØ</span>
            </div>
            <h3 style="font-size: 24px; font-weight: 700; color: #1e293b; margin: 0; word-wrap: break-word;"><%= @story.highlights_title %></h3>
          </div>
          <div style="background: linear-gradient(135deg, #faf5ff 0%, #fff 100%); padding: 24px; border-radius: 16px; border-left: 4px solid #a855f7; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
            <% if @story.highlights_text.present? %>
              <p style="font-size: 17px; line-height: 1.7; color: #475569; margin: 0 0 20px 0; word-wrap: break-word; overflow-wrap: break-word;">
                <%= @story.highlights_text %>
              </p>
            <% end %>
            <% if @story.highlights_items.present? %>
              <ul style="list-style: none; padding: 0; margin: 0;">
                <% @story.highlights_items.to_s.split("\n").reject(&:blank?).each do |item| %>
                  <li style="display: flex; align-items: start; gap: 10px; margin-bottom: 12px;">
                    <span style="flex-shrink: 0; width: 24px; height: 24px; background: #22c55e; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 14px;">‚úì</span>
                    <span style="color: #475569; word-wrap: break-word;"><%= item.strip %></span>
                  </li>
                <% end %>
              </ul>
            <% end %>
          </div>
        </div>
        <% end %>

        <div class="story-separator"></div>

        <%# CTA - COULEUR STORIES %>
        <div style="background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%); padding: 48px 32px; border-radius: 24px; text-align: center; position: relative; overflow: hidden; box-shadow: 0 20px 50px rgba(168,85,247,0.3);">
          <div style="position: absolute; top: -80px; right: -80px; width: 200px; height: 200px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
          <div style="position: absolute; bottom: -60px; left: -60px; width: 160px; height: 160px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
          <div style="position: relative;">
            <div style="font-size: 64px; margin-bottom: 16px;">‚ú®</div>
            <h3 class="story-cta-title" style="color: white; font-size: 30px; font-weight: 700; margin: 0 0 16px 0; word-wrap: break-word;">
              Et moi, comment je peux avoir le D√©clic ?
            </h3>
            <p style="color: rgba(255,255,255,0.95); font-size: 17px; margin: 0 auto 32px; max-width: 600px; line-height: 1.6; word-wrap: break-word; overflow-wrap: break-word;">
              Cette histoire vous inspire ? Des dizaines d'opportunit√©s similaires vous attendent pr√®s de chez vous pour entreprendre, vous former ou vous engager.
            </p>
            <div style="display: flex; flex-wrap: wrap; gap: 16px; justify-content: center;">
              <% if @story.source_name.present? && @story.source_url.present? %>
                <a href="<%= @story.source_url %>" target="_blank" rel="noopener" style="display: inline-flex; align-items: center; gap: 10px; background: white; color: #a855f7; padding: 16px 32px; border-radius: 999px; font-weight: 700; font-size: 16px; text-decoration: none; box-shadow: 0 8px 24px rgba(0,0,0,0.15); transition: transform 0.2s; white-space: nowrap;">
                  <svg style="width: 20px; height: 20px; flex-shrink: 0;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                  </svg>
                  <span style="overflow: hidden; text-overflow: ellipsis;">Lire sur <%= @story.source_name %></span>
                </a>
              <% end %>
              <a href="/opportunities" style="display: inline-flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); color: white; padding: 16px 32px; border-radius: 999px; border: 2px solid white; font-weight: 700; font-size: 16px; text-decoration: none; transition: background 0.2s; white-space: nowrap;">
                <svg style="width: 20px; height: 20px; flex-shrink: 0;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <span>Explorer</span>
              </a>
            </div>
          </div>
        </div>

      </div>

      <%# SIDEBAR %>
      <div class="story-sidebar" style="position: sticky; top: 32px; align-self: start; min-width: 0;">

        <%# Carte %>
        <% if @story.location.present? && @story.latitude.present? %>
          <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.1); border: 2px solid #e9d5ff; margin-bottom: 24px;">
            <div style="background: linear-gradient(135deg, #a855f7, #ec4899); padding: 16px;">
              <h3 style="color: white; font-weight: 700; font-size: 16px; margin: 0; display: flex; align-items: center; gap: 8px;">
                <span style="font-size: 20px;">üìç</span>
                Localisation
              </h3>
            </div>
            <div id="story-map" style="height: 240px;" data-lat="<%= @story.latitude %>" data-lon="<%= @story.longitude %>"></div>
            <div style="padding: 16px; background: #fafafa;">
              <p style="color: #475569; font-weight: 600; margin: 0; font-size: 14px; display: flex; align-items: start; gap: 8px; word-wrap: break-word; overflow-wrap: break-word;">
                <svg style="width: 18px; height: 18px; flex-shrink: 0; color: #a855f7; margin-top: 2px;" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path>
                </svg>
                <%= @story.location %>
              </p>
            </div>
          </div>
        <% end %>

        <%# Infos cl√©s %>
        <div style="background: white; border-radius: 20px; padding: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); border: 2px solid #e9d5ff; margin-bottom: 24px;">
          <h3 style="font-weight: 700; font-size: 18px; color: #1e293b; margin: 0 0 20px 0; display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 20px;">‚ÑπÔ∏è</span>
            Informations cl√©s
          </h3>

          <% if date_fr.present? %>
            <div style="display: flex; align-items: start; gap: 12px; padding: 16px; background: #faf5ff; border-radius: 12px; margin-bottom: 16px;">
              <div style="flex-shrink: 0; width: 44px; height: 44px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <span style="font-size: 20px;">üìÖ</span>
              </div>
              <div style="min-width: 0;">
                <div style="font-size: 11px; font-weight: 700; color: #7e22ce; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">Date</div>
                <div style="font-weight: 700; color: #1e293b; font-size: 14px; line-height: 1.4; word-wrap: break-word;"><%= date_fr %></div>
              </div>
            </div>
          <% end %>

          <% if @story.location.present? %>
            <div style="display: flex; align-items: start; gap: 12px; padding: 16px; background: #faf5ff; border-radius: 12px;">
              <div style="flex-shrink: 0; width: 44px; height: 44px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <span style="font-size: 20px;">üè™</span>
              </div>
              <div style="min-width: 0;">
                <div style="font-size: 11px; font-weight: 700; color: #7e22ce; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">Lieu</div>
                <div style="font-weight: 700; color: #1e293b; font-size: 14px; line-height: 1.4; word-wrap: break-word; overflow-wrap: break-word;"><%= @story.location %></div>
              </div>
            </div>
          <% end %>
        </div>

        <%# Partage %>
        <div style="background: linear-gradient(135deg, #f8fafc, #e2e8f0); border-radius: 20px; padding: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); border: 2px solid #cbd5e1; margin-bottom: 24px;">
          <h3 style="font-weight: 700; color: #1e293b; margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px; font-size: 16px;">
            <span style="font-size: 20px;">üì¢</span>
            Partagez
          </h3>
          <div style="display: flex; gap: 12px;">
            <a href="https://www.facebook.com/sharer/sharer.php?u=<%= request.original_url rescue '' %>" target="_blank" rel="noopener" style="flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px; background: #3b82f6; color: white; padding: 12px; border-radius: 12px; text-decoration: none; font-weight: 700; font-size: 13px; min-width: 0;">
              <svg style="width: 18px; height: 18px; flex-shrink: 0;" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
              <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">Facebook</span>
            </a>
            <a href="https://twitter.com/intent/tweet?url=<%= request.original_url rescue '' %>" target="_blank" rel="noopener" style="flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px; background: #1e293b; color: white; padding: 12px; border-radius: 12px; text-decoration: none; font-weight: 700; font-size: 13px; min-width: 0;">
              <svg style="width: 18px; height: 18px; flex-shrink: 0;" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
              <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">X</span>
            </a>
          </div>
        </div>

        <%# Citation %>
        <div style="background: linear-gradient(135deg, #a855f7, #ec4899); padding: 32px; border-radius: 20px; box-shadow: 0 10px 40px rgba(168,85,247,0.3); position: relative; overflow: hidden;">
          <div style="position: absolute; top: -20px; right: -20px; font-size: 120px; color: rgba(255,255,255,0.1); user-select: none; line-height: 1;">"</div>
          <div style="position: relative;">
            <div style="font-size: 48px; margin-bottom: 12px;">üí´</div>
            <p style="color: white; font-size: 16px; font-weight: 500; font-style: italic; line-height: 1.6; margin: 0; word-wrap: break-word; overflow-wrap: break-word;">
              Chaque grande histoire commence par un petit d√©clic. La v√¥tre commence aujourd'hui.
            </p>
          </div>
        </div>

      </div>

    </div>
  </div>

  <%# ESPACEMENT 3 %>
  <div class="story-spacing-1"></div>

  <%# ========== D√âCOUVERTE ========== %>
  <div style="border-top: 2px solid #e2e8f0;">
    <div style="background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%); padding: 80px 24px;">
      <div style="max-width: 900px; margin: 0 auto; text-align: center;">
        <div style="font-size: 64px; margin-bottom: 20px;">üåü</div>
        <h2 style="color: white; font-size: 38px; font-weight: 700; margin: 0 0 16px 0; word-wrap: break-word;">
          D√©couvrez d'autres histoires inspirantes
        </h2>
        <p style="color: #cbd5e1; font-size: 19px; margin: 0 auto 32px; max-width: 600px; line-height: 1.6; word-wrap: break-word;">
          Des centaines de personnes ont d√©j√† trouv√© leur D√©clic. √Ä votre tour de vous lancer dans l'aventure !
        </p>
        <a href="/stories" style="display: inline-flex; align-items: center; gap: 12px; background: linear-gradient(135deg, #a855f7, #ec4899); color: white; padding: 20px 48px; border-radius: 999px; font-weight: 700; font-size: 18px; text-decoration: none; box-shadow: 0 10px 40px rgba(168,85,247,0.4); white-space: nowrap;">
          <span>Toutes les Belles Histoires</span>
          <svg style="width: 22px; height: 22px; flex-shrink: 0;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
          </svg>
        </a>
      </div>
    </div>
  </div>

</div>

<%# CARTE LEAFLET %>
<% if @story.latitude.present? && @story.longitude.present? %>
<script>
function initStoryMap() {
  var el = document.getElementById('story-map');
  if (!el || el.dataset.mapInited === "1") return;
  var lat = parseFloat(el.dataset.lat);
  var lon = parseFloat(el.dataset.lon);
  if (!lat || !lon) return;
  var map = L.map(el, { scrollWheelZoom: false, zoomControl: true }).setView([lat, lon], 14);
  L.tileLayer('https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', { maxZoom: 20, attribution: '&copy; OpenStreetMap' }).addTo(map);
  var marker = L.marker([lat, lon]).addTo(map);
  marker.bindPopup("<div style='text-align:center;padding:12px;'><div style='font-size:24px;margin-bottom:8px;'>‚ú®</div><strong style='font-size:16px;'><%= @story.title.to_s.gsub("'", "\\'") rescue '' %></strong><br><span style='color:#64748b;'><%= @story.location.to_s.gsub("'", "\\'") rescue '' %></span></div>");
  el.dataset.mapInited = "1";
  setTimeout(() => map.invalidateSize(), 100);
}
if (document.readyState === "loading") { document.addEventListener("DOMContentLoaded", initStoryMap); } else { initStoryMap(); }
document.addEventListener("turbo:load", initStoryMap);
document.addEventListener("turbo:render", initStoryMap);
</script>
<% end %>
