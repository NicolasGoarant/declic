<%# app/views/admin/opportunities/index.html.erb %>
<div class="admin-container">
  <div class="admin-header">
    <h1 class="title">Gestion des Opportunit√©s</h1>
    <%= link_to "‚ûï Nouvelle Opportunit√©", new_admin_opportunity_path, class: "btn-main" %>
  </div>

  <div class="filter-bar">
    <%= form_with url: admin_opportunities_path, method: :get, local: true, class: "flex-form" do %>
      <input type="text" name="q" value="<%= @q %>" placeholder="Rechercher...">
      <select name="category">
        <option value="">Toutes les cat√©gories</option>
        <% Opportunity::CATEGORIES.each do |c| %>
          <option value="<%= c %>" <%= 'selected' if @cat == c %>><%= c.capitalize %></option>
        <% end %>
      </select>
      <label class="checkbox-label">
        <input type="checkbox" name="only_inactive" value="1" <%= "checked" if @only_in %>> ‚è≥ Brouillons
      </label>
      <button type="submit" class="btn-dark">Filtrer</button>
      <%= link_to "Reset", admin_opportunities_path, class: "reset-link" %>
    <% end %>
  </div>

  <table class="modern-table">
    <thead>
      <tr>
        <th>Statut</th>
        <th>Titre & Cat√©gorie</th>
        <th>Lieu</th>
        <th>Date</th>
        <th class="text-right">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @opportunities.each do |o| %>
        <tr>
          <td>
            <%= button_to toggle_active_admin_opportunity_path(o), method: :patch, style: "border:none; cursor:pointer; font-weight:800; font-size:10px; padding:4px 12px; border-radius:20px; #{o.is_active ? 'background:#dcfce7;color:#15803d;' : 'background:#fef3c7;color:#b45309;'}" do %>
              <%= o.is_active ? "PUBLI√â" : "BROUILLON" %>
            <% end %>
          </td>
          <td>
            <div class="row-title"><%= o.title %></div>
            <div class="row-subtitle"><%= o.category %></div>
          </td>
          <td>
            <span class="<%= 'warning' if o.latitude.blank? %>">
              <%= o.location.presence || "‚Äî" %>
            </span>
          </td>
          <td class="date-cell"><%= o.created_at.strftime("%d/%m/%Y") %></td>
          <td class="text-right">
            <div class="action-links">
              <%= link_to "‚úèÔ∏è", edit_admin_opportunity_path(o) %>
              <%= button_to "üóëÔ∏è", admin_opportunity_path(o), method: :delete, data: { confirm: "Supprimer ?" }, class: "btn-delete" %>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<style>
  .admin-container { padding: 20px; max-width: 1200px; margin: 0 auto; font-family: sans-serif; }
  .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
  .title { font-size: 24px; font-weight: 900; color: #1e293b; }
  .btn-main { background: #7c3aed; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: bold; }
  .filter-bar { background: white; padding: 15px; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 20px; }
  .flex-form { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }
  .flex-form input, .flex-form select { border: 1px solid #e2e8f0; padding: 8px; border-radius: 6px; }
  .checkbox-label { font-size: 13px; font-weight: 600; color: #64748b; cursor: pointer; }
  .modern-table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; border: 1px solid #e2e8f0; overflow: hidden; }
  .modern-table th { background: #f8fafc; padding: 12px; font-size: 11px; text-transform: uppercase; color: #64748b; border-bottom: 1px solid #e2e8f0; text-align: left; }
  .modern-table td { padding: 15px 12px; border-bottom: 1px solid #f1f5f9; }
  .status-badge { border: none; padding: 4px 10px; border-radius: 20px; font-size: 10px; font-weight: 800; cursor: pointer; transition: transform 0.1s; }
  .status-badge.active { background: #dcfce7; color: #15803d; }
  .status-badge.draft { background: #fef3c7; color: #b45309; }
  .status-badge:hover { transform: scale(1.05); }
  .row-title { font-weight: bold; color: #0f172a; font-size: 14px; }
  .row-subtitle { font-size: 12px; color: #94a3b8; text-transform: capitalize; }
  .warning { color: #ef4444; font-weight: bold; }
  .action-links { display: flex; gap: 10px; justify-content: flex-end; }
  .btn-delete { background: none; border: none; cursor: pointer; color: #ef4444; font-size: 1.1rem; }
  .date-cell { font-size: 12px; color: #64748b; }
</style>
