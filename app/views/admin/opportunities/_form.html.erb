<%# app/views/admin/opportunities/_form.html.erb - VERSION ORGANISÃ‰E %>

<%= form_with model: [:admin, @opportunity],
              local: true,
              html: { multipart: true, class: "admin-form-improved" } do |f| %>

  <% if @opportunity.errors.any? %>
    <div class="form-errors" style="background: #fee2e2; border: 1px solid #f87171; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem;">
      <h2 style="color: #991b1b; margin: 0 0 0.5rem 0;"><%= pluralize(@opportunity.errors.count, "erreur") %> :</h2>
      <ul style="margin: 0; padding-left: 1.5rem;">
        <% @opportunity.errors.full_messages.each do |m| %>
          <li style="color: #991b1b;"><%= m %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-sections">

    <%# ========== SECTION 1 : INFORMATIONS PRINCIPALES ========== %>
    <div class="form-section">
      <h3 class="form-section-title">ğŸ“ Contenu Principal</h3>
      <p class="form-section-subtitle">Informations essentielles de l'opportunitÃ©</p>

      <div class="form-row">
        <div class="field" style="flex: 2;">
          <%= f.label :title, "Titre *", class: "field-label" %>
          <%= f.text_field :title, placeholder: "Ex: Rejoignez le Repair CafÃ© de Nancy", class: "field-input", required: true %>
        </div>

        <div class="field">
          <%= f.label :category, "CatÃ©gorie *", class: "field-label" %>
          <%= f.select :category,
                [
                  ["BÃ©nÃ©volat", "benevolat"],
                  ["Formation", "formation"],
                  ["Rencontres", "rencontres"],
                  ["Entreprendre", "entreprendre"],
                  ["Ã‰cologiser", "ecologiser"]
                ],
                { include_blank: "(choisir)" },
                { class: "field-input", required: true } %>
        </div>

        <div class="field">
          <%= f.label :organization, "Organisation *", class: "field-label" %>
          <%= f.text_field :organization, placeholder: "Ex: Repair CafÃ© Nancy", class: "field-input", required: true %>
        </div>
      </div>

      <div class="field">
        <%= f.label :description, "Description (utilisez **texte** pour graisser) *", class: "field-label" %>
        <%= f.text_area :description, rows: 8, placeholder: "Description complÃ¨te de l'opportunitÃ©...", class: "field-input", required: true %>
        <div class="field-hint">Utilisez **gras** pour mettre en gras. Les emojis sont autorisÃ©s : âœ¨ ğŸ’¡ ğŸ”¥</div>
      </div>

      <div class="field">
        <label class="checkbox-field">
          <%= f.check_box :is_active %>
          <span>âœ… Visible sur le site (publier l'opportunitÃ©)</span>
        </label>
      </div>
    </div>

    <%# ========== SECTION 2 : CITATION / TÃ‰MOIGNAGE ========== %>
    <div class="form-section">
      <h3 class="form-section-title">ğŸ’¬ Citation / TÃ©moignage</h3>
      <p class="form-section-subtitle">Citation inspirante d'un participant (optionnel)</p>

      <div class="field">
        <%= f.label :quote, "Citation inspirante", class: "field-label" %>
        <%= f.text_area :quote, rows: 3, placeholder: "Â« En 48h, j'avais 15 messages de personnes prÃªtes Ã  aider... Â»", class: "field-input" %>
        <div class="field-hint">Ajoutez les guillemets Â« Â» si vous le souhaitez</div>
      </div>

      <div class="field">
        <%= f.label :quote_author, "Auteur de la citation", class: "field-label" %>
        <%= f.text_field :quote_author, placeholder: "Marie, fondatrice du Repair CafÃ©", class: "field-input" %>
      </div>
    </div>

    <%# ========== SECTION 3 : STATISTIQUES D'IMPACT ========== %>
    <div class="form-section">
      <h3 class="form-section-title">ğŸ“Š Statistiques d'impact</h3>
      <p class="form-section-subtitle">Jusqu'Ã  4 statistiques clÃ©s (optionnel)</p>

      <div class="stats-grid">
        <div class="stat-pair">
          <div class="field">
            <%= f.label :stat_1_number, "Stat 1 - Nombre", class: "field-label" %>
            <%= f.text_field :stat_1_number, placeholder: "200+", class: "field-input" %>
          </div>
          <div class="field">
            <%= f.label :stat_1_label, "Stat 1 - Label", class: "field-label" %>
            <%= f.text_field :stat_1_label, placeholder: "objets rÃ©parÃ©s", class: "field-input" %>
          </div>
        </div>

        <div class="stat-pair">
          <div class="field">
            <%= f.label :stat_2_number, "Stat 2 - Nombre", class: "field-label" %>
            <%= f.text_field :stat_2_number, placeholder: "45", class: "field-input" %>
          </div>
          <div class="field">
            <%= f.label :stat_2_label, "Stat 2 - Label", class: "field-label" %>
            <%= f.text_field :stat_2_label, placeholder: "participants rÃ©guliers", class: "field-input" %>
          </div>
        </div>

        <div class="stat-pair">
          <div class="field">
            <%= f.label :stat_3_number, "Stat 3 - Nombre", class: "field-label" %>
            <%= f.text_field :stat_3_number, placeholder: "3 ans", class: "field-input" %>
          </div>
          <div class="field">
            <%= f.label :stat_3_label, "Stat 3 - Label", class: "field-label" %>
            <%= f.text_field :stat_3_label, placeholder: "d'existence", class: "field-input" %>
          </div>
        </div>

        <div class="stat-pair">
          <div class="field">
            <%= f.label :stat_4_number, "Stat 4 - Nombre", class: "field-label" %>
            <%= f.text_field :stat_4_number, placeholder: "2x", class: "field-input" %>
          </div>
          <div class="field">
            <%= f.label :stat_4_label, "Stat 4 - Label", class: "field-label" %>
            <%= f.text_field :stat_4_label, placeholder: "par mois", class: "field-input" %>
          </div>
        </div>
      </div>
    </div>

    <%# ========== SECTION 4 : DÃ‰FIS SURMONTÃ‰S ========== %>
    <div class="form-section">
      <h3 class="form-section-title">ğŸ”¥ DÃ©fis surmontÃ©s</h3>
      <p class="form-section-subtitle">Un dÃ©fi par ligne (format: **DÃ©fi:** Solution)</p>

      <div class="field">
        <%= f.label :challenges, "DÃ©fis surmontÃ©s", class: "field-label" %>
        <%= f.text_area :challenges, rows: 6, class: "field-input", placeholder: "**Trouver un lieu :** NÃ©gociation avec la mairie pendant 2 mois
**Financement :** Campagne de dons qui a rÃ©uni 5000â‚¬
**Mobiliser les bÃ©nÃ©voles :** RÃ©unions publiques mensuelles" %>
        <div class="field-hint">Un dÃ©fi par ligne. Utilisez **DÃ©fi:** Solution</div>
      </div>
    </div>

    <%# ========== SECTION 5 : LOCALISATION ========== %>
    <div class="form-section">
      <h3 class="form-section-title">ğŸ“ Localisation</h3>
      <p class="form-section-subtitle">Adresse et coordonnÃ©es GPS</p>

      <div class="field">
        <%= f.label :location, "Adresse / Lieu *", class: "field-label" %>
        <%= f.text_field :location, placeholder: "21 Grande-Rue, 54000 Nancy", class: "field-input", required: true %>
      </div>

      <div class="form-row">
        <div class="field">
          <%= f.label :latitude, "Latitude", class: "field-label" %>
          <%= f.text_field :latitude, placeholder: "48.6937", step: "any", class: "field-input" %>
        </div>
        <div class="field">
          <%= f.label :longitude, "Longitude", class: "field-label" %>
          <%= f.text_field :longitude, placeholder: "6.1844", step: "any", class: "field-input" %>
        </div>
      </div>

      <div class="field-hint">
        ğŸ’¡ <a href="https://www.latlong.net/" target="_blank" rel="noopener">Trouver lat/lng sur LatLong.net</a>
      </div>
    </div>

    <%# ========== SECTION 6 : DATES & HORAIRES ========== %>
    <div class="form-section">
      <h3 class="form-section-title">ğŸ“… Dates & horaires</h3>
      <p class="form-section-subtitle">PÃ©riode et temps d'engagement</p>

      <div class="form-row">
        <div class="field">
          <%= f.label :start_date, "DÃ©but", class: "field-label" %>
          <%= f.date_field :start_date, class: "field-input" %>
        </div>
        <div class="field">
          <%= f.label :end_date, "Fin", class: "field-label" %>
          <%= f.date_field :end_date, class: "field-input" %>
        </div>
        <div class="field">
          <%= f.label :time_commitment, "Temps Ã  prÃ©voir", class: "field-label" %>
          <%= f.text_field :time_commitment, placeholder: "2h par semaine", class: "field-input" %>
        </div>
      </div>
    </div>

    <%# ========== SECTION 7 : IMAGES ========== %>
    <div class="form-section">
      <h3 class="form-section-title">ğŸ–¼ï¸ Images</h3>
      <p class="form-section-subtitle">Photos pour illustrer l'opportunitÃ©</p>

      <%# IMAGE HERO %>
      <div style="background: #f8fafc; padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 2rem;">
        <h4 style="font-weight: 700; color: #0f172a; margin: 0 0 1rem 0; font-size: 1rem;">
          ğŸ“¸ Image principale (bandeau)
        </h4>

        <div class="field">
          <%= f.label :image, "Image (upload)", class: "field-label" %>
          <%= f.file_field :image, accept: "image/*", class: "field-input" %>
          <% if @opportunity.image.attached? %>
            <div class="current-image">
              <%= image_tag @opportunity.image, style: "max-width: 200px; border-radius: 8px; margin-top: 0.5rem;" %>
            </div>
          <% end %>
        </div>

        <div class="field">
          <%= f.label :image_url, "OU Image (URL externe)", class: "field-label" %>
          <%= f.text_field :image_url, placeholder: "https://images.unsplash.com/photo-...", class: "field-input" %>
          <div class="field-hint">Si vous n'avez pas uploadÃ© d'image ci-dessus</div>
        </div>
      </div>

      <%# GALERIE 3 PHOTOS %>
      <div style="background: #f0f9ff; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #3b82f6;">
        <h4 style="font-weight: 700; color: #1e40af; margin: 0 0 0.5rem 0; font-size: 1rem;">
          ğŸ“¸ Galerie photos (bloc sous le bandeau)
        </h4>
        <p style="color: #475569; font-size: 0.875rem; margin: 0 0 1.5rem 0;">
          Ajoutez jusqu'Ã  3 photos pour illustrer l'initiative. Elles s'afficheront juste sous l'image principale dans un grid Ã©lÃ©gant 2+1.
        </p>

        <div class="field">
          <%= f.label :gallery_image_1, "Photo 1 de la galerie", class: "field-label" %>
          <%= f.file_field :gallery_image_1, accept: "image/*", class: "field-input" %>
          <% if @opportunity.respond_to?(:gallery_image_1) && @opportunity.gallery_image_1.attached? %>
            <div class="current-image">
              <%= image_tag @opportunity.gallery_image_1, style: "max-width: 150px; border-radius: 8px; margin-top: 0.5rem;" %>
            </div>
          <% end %>
          <div class="field-hint">ğŸ–¼ï¸ PremiÃ¨re photo de la galerie</div>
        </div>

        <div class="field">
          <%= f.label :gallery_image_2, "Photo 2 de la galerie", class: "field-label" %>
          <%= f.file_field :gallery_image_2, accept: "image/*", class: "field-input" %>
          <% if @opportunity.respond_to?(:gallery_image_2) && @opportunity.gallery_image_2.attached? %>
            <div class="current-image">
              <%= image_tag @opportunity.gallery_image_2, style: "max-width: 150px; border-radius: 8px; margin-top: 0.5rem;" %>
            </div>
          <% end %>
          <div class="field-hint">ğŸ–¼ï¸ DeuxiÃ¨me photo de la galerie</div>
        </div>

        <div class="field">
          <%= f.label :gallery_image_3, "Photo 3 de la galerie", class: "field-label" %>
          <%= f.file_field :gallery_image_3, accept: "image/*", class: "field-input" %>
          <% if @opportunity.respond_to?(:gallery_image_3) && @opportunity.gallery_image_3.attached? %>
            <div class="current-image">
              <%= image_tag @opportunity.gallery_image_3, style: "max-width: 150px; border-radius: 8px; margin-top: 0.5rem;" %>
            </div>
          <% end %>
          <div class="field-hint">ğŸ–¼ï¸ TroisiÃ¨me photo (sera centrÃ©e en dessous des 2 premiÃ¨res)</div>
        </div>

        <div class="field-note" style="background: #dbeafe; border-left: 4px solid #3b82f6; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem;">
          <strong style="color: #1e40af;">ğŸ’¡ Recommandation :</strong>
          <ul style="margin: 0.5rem 0 0 1.5rem; color: #1e3a8a;">
            <li><strong>3 photos maximum</strong> pour un Ã©quilibre optimal entre visuel et contenu</li>
            <li>La 3e photo sera Ã©lÃ©gamment centrÃ©e sous les 2 premiÃ¨res</li>
            <li>Choisissez des photos complÃ©mentaires : Ã©quipe â†’ lieu â†’ rÃ©sultat</li>
            <li>Format idÃ©al : 800x600px, ratio 4:3</li>
            <li>PrivilÃ©giez des photos qui racontent une histoire progressive</li>
          </ul>
        </div>
      </div>
    </div>

    <%# ========== SECTION 8 : SOURCE & CONTACT ========== %>
    <div class="form-section">
      <h3 class="form-section-title">ğŸ“° Source & Contact</h3>
      <p class="form-section-subtitle">Informations de rÃ©fÃ©rence et liens d'action</p>

      <div class="form-row">
        <div class="field">
          <%= f.label :source_name, "Nom de la source", class: "field-label" %>
          <%= f.text_field :source_name, placeholder: "L'Est RÃ©publicain", class: "field-input" %>
        </div>
        <div class="field" style="flex: 2;">
          <%= f.label :source_url, "URL source (article)", class: "field-label" %>
          <%= f.text_field :source_url, placeholder: "https://www.estrepublicain.fr/...", class: "field-input" %>
          <div class="field-hint">ğŸ”— CrÃ©e le bouton "ğŸ“„ En savoir plus" dans la section CTA</div>
        </div>
      </div>

      <div class="field">
        <%= f.label :website, "Site web de l'organisation", class: "field-label" %>
        <%= f.text_field :website, placeholder: "https://sandcreation.fr", class: "field-input" %>
        <div class="field-hint">
          ğŸ¯ <strong>Important :</strong> CrÃ©e le bouton principal dans la section "PrÃªt Ã  passer Ã  l'action"
          (ex: "ğŸš€ Me lancer" pour Entreprendre, "ğŸŒ± Agir" pour Ã‰cologiser)
        </div>
      </div>

      <div class="field">
        <%= f.label :contact_email, "Email de contact", class: "field-label" %>
        <%= f.email_field :contact_email, placeholder: "contact@sandcreation.fr", class: "field-input" %>
        <div class="field-hint">ğŸ’¬ CrÃ©e le bouton "Contacter l'organisation" dans la section CTA</div>
      </div>

      <div class="field">
        <%= f.label :contact_phone, "TÃ©lÃ©phone de contact", class: "field-label" %>
        <%= f.telephone_field :contact_phone, placeholder: "06 12 34 56 78", class: "field-input" %>
        <div class="field-hint">ğŸ“± Optionnel - AffichÃ© dans l'encadrÃ© d'infos Ã  droite</div>
      </div>

      <div class="field-note" style="background: #dbeafe; border-left: 4px solid #3b82f6; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem;">
        <strong style="color: #1e40af;">ğŸ’¡ Astuce :</strong>
        <p style="margin: 0.5rem 0 0 0; color: #1e3a8a;">
          Remplissez au moins le <strong>site web</strong> et l'<strong>email</strong> pour que les visiteurs puissent
          facilement passer Ã  l'action via les boutons "PrÃªt Ã  passer Ã  l'action" en bas de la page.
        </p>
      </div>
    </div>

    <%# ========== SECTION 9 : SEO & TAGS ========== %>
    <div class="form-section">
      <h3 class="form-section-title">ğŸ·ï¸ SEO & Organisation</h3>
      <p class="form-section-subtitle">Identifiant unique et mots-clÃ©s</p>

      <div class="form-row">
        <div class="field" style="flex: 2;">
          <%= f.label :slug, "Slug (URL)", class: "field-label" %>
          <%= f.text_field :slug, placeholder: "repair-cafe-nancy", class: "field-input" %>
          <div class="field-hint">Laissez vide pour gÃ©nÃ©ration automatique depuis le titre</div>
        </div>
        <div class="field">
          <%= f.label :tags, "Tags", class: "field-label" %>
          <%= f.text_field :tags, placeholder: "rÃ©paration, Ã©cologie, bÃ©nÃ©volat", class: "field-input" %>
          <div class="field-hint">SÃ©parÃ©s par des virgules</div>
        </div>
      </div>
    </div>

  </div>

  <%# ACTIONS %>
  <div class="form-actions">
    <%= f.submit "Enregistrer", class: "btn-primary" %>
    <%= link_to "Annuler", admin_opportunities_path, class: "btn-secondary" %>
  </div>

<% end %>

<style>
/* Styles pour le formulaire amÃ©liorÃ© */
.admin-form-improved { max-width: 1200px; margin: 0 auto; }

.form-sections { display: flex; flex-direction: column; gap: 2rem; }

.form-section {
  background: white;
  border: 2px solid #e2e8f0;
  border-radius: 1rem;
  padding: 1.5rem;
}

.form-section-title {
  font-size: 1.25rem;
  font-weight: 800;
  color: #0f172a;
  margin: 0 0 0.25rem 0;
}

.form-section-subtitle {
  font-size: 0.875rem;
  color: #64748b;
  margin: 0 0 1.5rem 0;
}

.form-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 1rem;
}

.field {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.field-label {
  font-weight: 700;
  color: #334155;
  font-size: 0.875rem;
}

.field-input {
  padding: 0.75rem;
  border: 1px solid #cbd5e1;
  border-radius: 0.5rem;
  font-size: 1rem;
  width: 100%;
}

.field-input:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.field-hint {
  font-size: 0.75rem;
  color: #64748b;
  margin-top: 0.25rem;
}

.field-hint a {
  color: #3b82f6;
  text-decoration: underline;
}

.checkbox-field {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 600;
  color: #334155;
  cursor: pointer;
}

.checkbox-field input[type="checkbox"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1rem;
}

.stat-pair {
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: 0.5rem;
}

.form-actions {
  display: flex;
  gap: 1rem;
  padding: 1.5rem 0;
  border-top: 2px solid #e2e8f0;
  margin-top: 2rem;
}

.btn-primary {
  background: #3b82f6;
  color: white;
  padding: 0.75rem 2rem;
  border-radius: 0.5rem;
  font-weight: 700;
  border: none;
  cursor: pointer;
  font-size: 1rem;
}

.btn-primary:hover {
  background: #2563eb;
}

.btn-secondary {
  background: #f1f5f9;
  color: #475569;
  padding: 0.75rem 2rem;
  border-radius: 0.5rem;
  font-weight: 700;
  border: 1px solid #cbd5e1;
  text-decoration: none;
  display: inline-block;
}

.btn-secondary:hover {
  background: #e2e8f0;
}
</style>
