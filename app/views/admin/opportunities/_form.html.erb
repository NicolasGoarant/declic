<%= form_with model: [:admin, @opportunity],
              local: true,
              html: { multipart: true } do |f| %>

  <% if @opportunity.errors.any? %>
    <div class="form-errors">
      <h2><%= pluralize(@opportunity.errors.count, "erreur") %> :</h2>
      <ul>
        <% @opportunity.errors.full_messages.each do |m| %>
          <li><%= m %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-grid">
    <div class="field">
      <%= f.label :title, "Titre" %>
      <%= f.text_field :title %>
    </div>

    <div class="field">
      <%= f.label :category, "CatÃ©gorie" %>
      <%= f.select :category,
            [
              ["BÃ©nÃ©volat", "benevolat"],
              ["Formation", "formation"],
              ["Rencontres", "rencontres"],
              ["Entreprendre", "entreprendre"],
              ["Ã‰cologiser", "ecologiser"]
            ],
            { include_blank: "(choisir)" } %>
    </div>

    <div class="field">
      <%= f.label :is_active, "Active ?" %>
      <div class="checkbox-inline">
        <%= f.check_box :is_active %>
        <span>Visible sur le site</span>
      </div>
    </div>

    <div class="field">
      <%= f.label :organization, "Organisation" %>
      <%= f.text_field :organization %>
    </div>

    <div class="field full">
      <%= f.label :description, "Description (utilisez **texte** pour grasser)" %>
      <%= f.text_area :description, rows: 8 %>
      <small style="color:#64748b;font-size:0.85rem;margin-top:0.25rem">Utilisez **mot** pour mettre en gras</small>
    </div>

    <!-- NOUVEAUX CHAMPS : CITATION -->
    <div class="field full" style="background:#f0fdf4;padding:1rem;border-radius:8px;border:1px solid #86efac">
      <strong style="color:#16a34a;margin-bottom:0.5rem;display:block">ðŸ’¬ Citation / TÃ©moignage</strong>
      <%= f.label :quote, "Citation inspirante" %>
      <%= f.text_area :quote, rows: 3, placeholder: "Â« En 48h, j'avais 15 messages de personnes prÃªtes Ã  aider... Â»" %>
    </div>

    <div class="field">
      <%= f.label :quote_author, "Auteur de la citation" %>
      <%= f.text_field :quote_author, placeholder: "Marie, fondatrice" %>
    </div>

    <!-- NOUVEAUX CHAMPS : STATISTIQUES -->
    <div class="field full" style="background:#eff6ff;padding:1rem;border-radius:8px;border:1px solid:#93c5fd;margin-top:1rem">
      <strong style="color:#2563eb;margin-bottom:0.5rem;display:block">ðŸ“Š Statistiques d'impact (4 stats max)</strong>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:0.75rem">
        <div>
          <%= f.label :stat_1_number, "Stat 1 - Nombre" %>
          <%= f.text_field :stat_1_number, placeholder: "200+" %>
        </div>
        <div>
          <%= f.label :stat_1_label, "Stat 1 - Label" %>
          <%= f.text_field :stat_1_label, placeholder: "objets rÃ©parÃ©s" %>
        </div>
        <div>
          <%= f.label :stat_2_number, "Stat 2 - Nombre" %>
          <%= f.text_field :stat_2_number, placeholder: "45" %>
        </div>
        <div>
          <%= f.label :stat_2_label, "Stat 2 - Label" %>
          <%= f.text_field :stat_2_label, placeholder: "participants" %>
        </div>
        <div>
          <%= f.label :stat_3_number, "Stat 3 - Nombre" %>
          <%= f.text_field :stat_3_number, placeholder: "3 ans" %>
        </div>
        <div>
          <%= f.label :stat_3_label, "Stat 3 - Label" %>
          <%= f.text_field :stat_3_label, placeholder: "d'existence" %>
        </div>
        <div>
          <%= f.label :stat_4_number, "Stat 4 - Nombre" %>
          <%= f.text_field :stat_4_number, placeholder: "2x" %>
        </div>
        <div>
          <%= f.label :stat_4_label, "Stat 4 - Label" %>
          <%= f.text_field :stat_4_label, placeholder: "par mois" %>
        </div>
      </div>
    </div>

    <!-- NOUVEAUX CHAMPS : DÃ‰FIS -->
    <div class="field full" style="background:#fff1f2;padding:1rem;border-radius:8px;border:1px solid #fca5a5;margin-top:1rem">
      <strong style="color:#dc2626;margin-bottom:0.5rem;display:block">ðŸ’ª DÃ©fis surmontÃ©s</strong>
      <%= f.label :challenges, "Un dÃ©fi par ligne (format: **DÃ©fi:** Solution)" %>
      <%= f.text_area :challenges, rows: 5, placeholder: "**Trouver un lieu :** NÃ©gociation avec la mairie\n**Assurance :** Souscription via l'association\n**MatÃ©riel :** Appel aux dons" %>
      <small style="color:#64748b;font-size:0.85rem;margin-top:0.25rem">Format : **Titre du dÃ©fi :** Description de la solution (un par ligne)</small>
    </div>

    <div class="field">
      <%= f.label :location, "Adresse / lieu" %>
      <%= f.text_field :location %>
    </div>

    <div class="field">
      <%= f.label :time_commitment, "Temps Ã  prÃ©voir" %>
      <%= f.text_field :time_commitment %>
    </div>

    <div class="field">
      <%= f.label :starts_at, "DÃ©but" %>
      <%= f.datetime_select :starts_at, include_blank: true %>
    </div>

    <div class="field">
      <%= f.label :ends_at, "Fin" %>
      <%= f.datetime_select :ends_at, include_blank: true %>
    </div>

    <!-- Image upload / URL -->
    <div class="field">
      <%= f.label :image, "Image (upload)" %>
      <%= f.file_field :image, direct_upload: true %>
      <% if @opportunity.image.attached? %>
        <p class="preview-label">Image actuelle :</p>
        <%= image_tag @opportunity.image.variant(resize_to_limit: [300, 180]),
                      class: "preview-img" rescue nil %>
      <% end %>
    </div>

    <div class="field">
      <%= f.label :image_url, "Image (URL externe)" %>
      <%= f.text_field :image_url, placeholder: "https://â€¦" %>
    </div>

    <div class="field">
      <%= f.label :website, "Site web (URL)" %>
      <%= f.text_field :website %>
    </div>

    <div class="field">
      <%= f.label :source_url, "Lien source / infos" %>
      <%= f.text_field :source_url %>
    </div>

    <div class="field">
      <%= f.label :contact_email, "Email contact" %>
      <%= f.email_field :contact_email %>
    </div>

    <div class="field">
      <%= f.label :contact_phone, "TÃ©lÃ©phone contact" %>
      <%= f.telephone_field :contact_phone %>
    </div>

    <div class="field">
      <%= f.label :tags, "Tags (sÃ©parÃ©s par des virgules)" %>
      <%= f.text_field :tags %>
    </div>

    <div class="field">
      <%= f.label :latitude %>
      <%= f.text_field :latitude %>
    </div>

    <div class="field">
      <%= f.label :longitude %>
      <%= f.text_field :longitude %>
    </div>
  </div>

  <div class="form-actions">
    <%= f.submit class: "btn" %>
    <%= link_to "Annuler", admin_opportunities_path, class: "btn ghost" %>
  </div>
<% end %>

<style>
.form-errors{background:#fef2f2;border:1px solid #fecaca;color:#b91c1c;padding:.75rem 1rem;border-radius:8px;margin-bottom:1rem}
.form-errors h2{margin:0 0 .5rem;font-weight:700;font-size:.95rem}
.form-errors ul{margin:0;padding-left:1.1rem}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin-top:.5rem}
.field{display:flex;flex-direction:column;gap:.25rem}
.field.full{grid-column:1/-1}
.field label{font-weight:600;font-size:.9rem;color:#334155}
.field input,.field textarea,.field select{border:1px solid #cbd5e1;border-radius:8px;padding:.4rem .55rem;font:inherit}
.checkbox-inline{display:flex;align-items:center;gap:.4rem;margin-top:.15rem}
.form-actions{margin-top:1.2rem;display:flex;gap:.5rem}
.preview-label{margin-top:.4rem;font-size:.85rem;color:#64748b}
.preview-img{margin-top:.25rem;border-radius:8px;border:1px solid #e5e7eb;max-width:100%;height:auto}
.btn{padding:.625rem 1.25rem;border-radius:8px;font-weight:600;text-decoration:none;display:inline-block;border:none;cursor:pointer}
.btn:not(.ghost){background:#6366f1;color:white}
.btn.ghost{background:transparent;border:1px solid #cbd5e1;color:#334155}
</style>
