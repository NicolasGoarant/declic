<%= form_with model: [:admin, @opportunity],
              local: true,
              html: { multipart: true } do |f| %>

  <% if @opportunity.errors.any? %>
    <div class="form-errors">
      <h2><%= pluralize(@opportunity.errors.count, "erreur") %> :</h2>
      <ul>
        <% @opportunity.errors.full_messages.each do |m| %>
          <li><%= m %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-grid">
    <div class="field">
      <%= f.label :title, "Titre" %>
      <%= f.text_field :title %>
    </div>

    <div class="field">
      <%= f.label :category, "Catégorie" %>
      <%= f.select :category,
            [
              ["Bénévolat", "benevolat"],
              ["Formation", "formation"],
              ["Rencontres", "rencontres"],
              ["Entreprendre", "entreprendre"],
              ["Écologiser", "ecologiser"]
            ],
            { include_blank: "(choisir)" } %>
    </div>

    <div class="field">
      <%= f.label :is_active, "Active ?" %>
      <div class="checkbox-inline">
        <%= f.check_box :is_active %>
        <span>Visible sur le site</span>
      </div>
    </div>

    <div class="field">
      <%= f.label :organization, "Organisation" %>
      <%= f.text_field :organization %>
    </div>

    <div class="field full">
      <%= f.label :description, "Description (markdown accepté)" %>
      <%= f.text_area :description, rows: 8 %>
    </div>

    <div class="field">
      <%= f.label :location, "Adresse / lieu" %>
      <%= f.text_field :location %>
    </div>

    <div class="field">
      <%= f.label :time_commitment, "Temps à prévoir" %>
      <%= f.text_field :time_commitment %>
    </div>

    <div class="field">
      <%= f.label :starts_at, "Début" %>
      <%= f.datetime_select :starts_at, include_blank: true %>
    </div>

    <div class="field">
      <%= f.label :ends_at, "Fin" %>
      <%= f.datetime_select :ends_at, include_blank: true %>
    </div>

    <!-- Image upload / URL -->
    <div class="field">
      <%= f.label :image, "Image (upload)" %>
      <%= f.file_field :image, direct_upload: true %>
      <% if @opportunity.image.attached? %>
        <p class="preview-label">Image actuelle :</p>
        <%= image_tag @opportunity.image.variant(resize_to_limit: [300, 180]),
                      class: "preview-img" rescue nil %>
      <% end %>
    </div>

    <div class="field">
      <%= f.label :image_url, "Image (URL externe)" %>
      <%= f.text_field :image_url, placeholder: "https://…" %>
    </div>

    <div class="field">
      <%= f.label :website, "Site web (URL)" %>
      <%= f.text_field :website %>
    </div>

    <div class="field">
      <%= f.label :source_url, "Lien source / infos" %>
      <%= f.text_field :source_url %>
    </div>

    <div class="field">
      <%= f.label :contact_email, "Email contact" %>
      <%= f.email_field :contact_email %>
    </div>

    <div class="field">
      <%= f.label :contact_phone, "Téléphone contact" %>
      <%= f.telephone_field :contact_phone %>
    </div>

    <div class="field">
      <%= f.label :tags, "Tags (séparés par des virgules)" %>
      <%= f.text_field :tags %>
    </div>

    <div class="field">
      <%= f.label :latitude %>
      <%= f.text_field :latitude %>
    </div>

    <div class="field">
      <%= f.label :longitude %>
      <%= f.text_field :longitude %>
    </div>
  </div>

  <div class="form-actions">
    <%= f.submit class: "btn" %>
    <%= link_to "Annuler", admin_opportunities_path, class: "btn ghost" %>
  </div>
<% end %>

<style>
.form-errors{background:#fef2f2;border:1px solid #fecaca;color:#b91c1c;padding:.75rem 1rem;border-radius:8px;margin-bottom:1rem}
.form-errors h2{margin:0 0 .5rem;font-weight:700;font-size:.95rem}
.form-errors ul{margin:0;padding-left:1.1rem}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin-top:.5rem}
.field{display:flex;flex-direction:column;gap:.25rem}
.field.full{grid-column:1/-1}
.field label{font-weight:600;font-size:.9rem;color:#334155}
.field input,.field textarea,.field select{border:1px solid #cbd5e1;border-radius:8px;padding:.4rem .55rem;font:inherit}
.checkbox-inline{display:flex;align-items:center;gap:.4rem;margin-top:.15rem}
.form-actions{margin-top:1.2rem;display:flex;gap:.5rem}
.preview-label{margin-top:.4rem;font-size:.85rem;color:#64748b}
.preview-img{margin-top:.25rem;border-radius:8px;border:1px solid #e5e7eb;max-width:100%;height:auto}
</style>
