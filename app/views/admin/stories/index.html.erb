<%# app/views/admin/stories/index.html.erb %>
<div class="admin-container">
  <div class="admin-header">
    <h1 class="title">Gestion des Stories</h1>
    <%= link_to "‚ûï Nouvelle Story", new_admin_story_path, class: "btn-main" %>
  </div>

  <div class="filter-bar">
    <%= form_with url: admin_stories_path, method: :get, local: true, class: "flex-form" do %>
      <input type="text" name="q" value="<%= @q %>" placeholder="Rechercher...">
      <label>
        <input type="checkbox" name="missing_coords" value="1" <%= "checked" if @missing %>> üìç Coords manquantes
      </label>
      <button type="submit" class="btn-dark">Filtrer</button>
      <%= link_to "Reset", admin_stories_path, class: "reset-link" %>
    <% end %>
  </div>

  <table class="modern-table">
    <thead>
      <tr>
        <th>Statut</th>
        <th>Titre & Auteur</th>
        <th>Lieu</th>
        <th>Date</th>
        <th class="text-right">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @stories.each do |s| %>
        <tr>
          <td>
            <%= button_to toggle_active_admin_story_path(s),
                          method: :patch,
                          class: "status-badge #{s.is_active ? 'active' : 'draft'}" do %>
              <%= s.is_active ? "PUBLI√â" : "BROUILLON" %>
            <% end %>
          </td>
          <td>
            <div class="row-title"><%= s.title %></div>
            <div class="row-subtitle"><%= s.author_name %></div>
          </td>
          <td>
            <span class="<%= 'warning' if s.latitude.blank? %>">
              <%= s.location.presence || "‚Äî" %>
            </span>
          </td>
          <td class="date-cell"><%= s.created_at.strftime("%d/%m/%Y") %></td>
          <td class="text-right">
            <div class="action-links">
              <%= link_to "‚úèÔ∏è", edit_admin_story_path(s) %>
              <%= button_to "üóëÔ∏è", admin_story_path(s), method: :delete, data: { confirm: "Supprimer ?" }, class: "btn-delete" %>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<style>
  .admin-container { padding: 20px; max-width: 1200px; margin: 0 auto; font-family: sans-serif; }
  .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
  .title { font-size: 24px; font-weight: 900; color: #1e293b; }
  .btn-main { background: #7c3aed; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: bold; }

  .filter-bar { background: white; padding: 15px; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 20px; }
  .flex-form { display: flex; gap: 15px; align-items: center; }

  .modern-table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; border: 1px solid #e2e8f0; overflow: hidden; }
  .modern-table th { background: #f8fafc; padding: 12px; font-size: 11px; text-transform: uppercase; color: #64748b; border-bottom: 1px solid #e2e8f0; }
  .modern-table td { padding: 15px 12px; border-bottom: 1px solid #f1f5f9; }

  .status-badge { border: none; padding: 4px 10px; border-radius: 20px; font-size: 10px; font-weight: 800; cursor: pointer; }
  .status-badge.active { background: #dcfce7; color: #15803d; }
  .status-badge.draft { background: #fef3c7; color: #b45309; }

  .row-title { font-weight: bold; color: #0f172a; }
  .row-subtitle { font-size: 12px; color: #64748b; }
  .warning { color: #ef4444; font-weight: bold; }
  .action-links { display: flex; gap: 10px; justify-content: flex-end; }
  .btn-delete { background: none; border: none; cursor: pointer; color: #ef4444; }
</style>
